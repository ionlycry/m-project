{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getCommentListApi } from '@/api/comment';\nimport CommentItem from '@/views/Comment/CommentItem';\nexport default {\n  components: {\n    CommentItem\n  },\n  props: {\n    sourceId: {\n      type: [Number, String, Object],\n      required: true\n    },\n    // 评论类型，a是文章，c是评论\n    type: {\n      type: String,\n      required: true\n    }\n  },\n  data() {\n    return {\n      commentLoading: false,\n      commentFinished: false,\n      offset: null,\n      // 获取下一页数据的标记\n      limit: 10,\n      commentList: []\n    };\n  },\n  methods: {\n    // 加载评论列表\n    async onLoad() {\n      // 异步更新数据\n      // setTimeout 仅做示例，真实场景中一般为 ajax 请求\n      this.commentLoading = true;\n      try {\n        const {\n          data\n        } = await getCommentListApi({\n          type: this.type,\n          source: this.sourceId,\n          offset: this.offset,\n          limit: this.limit\n        });\n        console.log(data);\n        const {\n          results\n        } = data.data;\n        this.commentList.push(...results);\n        // 加载状态结束\n        this.commentLoading = false;\n        // console.log('返回结果的长度', results.length)\n        if (results.length) {\n          // 数据有长度，说明有内容\n          this.offset = data.data.last_id;\n          // console.log('lastid', data.data.last_id)\n          // console.log('endid', data.data.end_id)\n        } else {\n          this.commentFinished = true;\n        }\n      } catch (error) {\n        console.log(error);\n        // 加载状态结束\n        this.commentLoading = false;\n      }\n    },\n    showReplyPopFn(value) {\n      this.$emit('showReplyPopup', value);\n    }\n  }\n};","map":{"version":3,"mappings":";AAiBA;AACA;AACA;EACAA;IACAC;EACA;EACAC;IACAC;MACAC;MACAC;IACA;IACA;IACAD;MACAA;MACAC;IACA;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACA;MACA;MACA;MACA;MACA;QACA;UAAAN;QAAA;UACAF;UACAS;UACAJ;UACAC;QACA;QACAI;QACA;UAAAC;QAAA;QACA;QACA;QACA;QACA;QACA;UACA;UACA;UACA;UACA;QACA;UACA;QACA;MACA;QACAD;QACA;QACA;MACA;IACA;IACAE;MACA;IACA;EACA;AACA","names":["components","CommentItem","props","sourceId","type","required","data","commentLoading","commentFinished","offset","limit","commentList","methods","source","console","results","showReplyPopFn"],"sourceRoot":"src/views/Comment","sources":["CommentList.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <van-list\r\n      v-model=\"commentLoading\"\r\n      :finished=\"commentFinished\"\r\n      finished-text=\"没有更多了\"\r\n      @load=\"onLoad\">\r\n      <CommentItem\r\n        v-for=\"(item, index) in commentList\"\r\n        :key=\"index\"\r\n        :comments=\"item\"\r\n        @showReplyPop=\"showReplyPopFn\"></CommentItem>\r\n    </van-list>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getCommentListApi } from '@/api/comment'\r\nimport CommentItem from '@/views/Comment/CommentItem'\r\nexport default {\r\n  components: {\r\n    CommentItem,\r\n  },\r\n  props: {\r\n    sourceId: {\r\n      type: [Number, String, Object],\r\n      required: true,\r\n    },\r\n    // 评论类型，a是文章，c是评论\r\n    type: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      commentLoading: false,\r\n      commentFinished: false,\r\n      offset: null, // 获取下一页数据的标记\r\n      limit: 10,\r\n      commentList: [],\r\n    }\r\n  },\r\n  methods: {\r\n    // 加载评论列表\r\n    async onLoad() {\r\n      // 异步更新数据\r\n      // setTimeout 仅做示例，真实场景中一般为 ajax 请求\r\n      this.commentLoading = true\r\n      try {\r\n        const { data } = await getCommentListApi({\r\n          type: this.type,\r\n          source: this.sourceId,\r\n          offset: this.offset,\r\n          limit: this.limit,\r\n        })\r\n        console.log(data)\r\n        const { results } = data.data\r\n        this.commentList.push(...results)\r\n        // 加载状态结束\r\n        this.commentLoading = false\r\n        // console.log('返回结果的长度', results.length)\r\n        if (results.length) {\r\n          // 数据有长度，说明有内容\r\n          this.offset = data.data.last_id\r\n          // console.log('lastid', data.data.last_id)\r\n          // console.log('endid', data.data.end_id)\r\n        } else {\r\n          this.commentFinished = true\r\n        }\r\n      } catch (error) {\r\n        console.log(error)\r\n        // 加载状态结束\r\n        this.commentLoading = false\r\n      }\r\n    },\r\n    showReplyPopFn(value) {\r\n      this.$emit('showReplyPopup', value)\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}