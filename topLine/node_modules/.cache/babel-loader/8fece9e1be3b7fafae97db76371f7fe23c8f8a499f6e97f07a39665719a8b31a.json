{"ast":null,"code":"import { login } from '@/api/user';\nexport default {\n  name: 'Login',\n  data() {\n    return {\n      isShowCountDown: false,\n      user: {\n        mobile: '18612345678',\n        code: '246810'\n      },\n      regRules: {\n        regPhone: [{\n          required: true,\n          message: '请填写手机号'\n        }, {\n          pattern: /^1(3\\d|4[5-9]|5[0-35-9]|6[567]|7[0-8]|8\\d|9[0-35-9])\\d{8}$/,\n          message: '手机号格式错误'\n        }],\n        regCode: [{\n          required: true,\n          message: '请填写验证码'\n        }, {\n          pattern: /^\\d{6}$/,\n          message: '验证码格式不正确'\n        }]\n      }\n    };\n  },\n  methods: {\n    async onSubmit() {\n      const user = this.user;\n      // 显示loading\n      this.$toast.loading({\n        message: '加载中...',\n        forbidClick: true,\n        duration: 0 //持续展示\n      });\n      //  发起请求，获取数据\n      try {\n        const {\n          data\n        } = await login(user);\n        // console.log('登录成功', res)\n        // 通过vuex设置state中user的信息，包含token和refresh token\n        this.$store.commit('setUser', data.data);\n        this.$toast.success({\n          message: '登录成功',\n          duration: 800\n        });\n        this.$router.back();\n      } catch (error) {\n        // console.log(error)\n        if (error.response.status === 400) {\n          this.$toast.fail({\n            message: error.response.data.message,\n            duration: 800\n          });\n        } else {\n          this.$toast.fail({\n            message: '登陆失败',\n            duration: 800\n          });\n          console.log('登录失败', error);\n        }\n      }\n    },\n    async sendSms() {\n      // 验证 手机号\n      // validate('mobile') 返回promise对象\n      try {\n        // console.log(1)\n        await this.$refs.loginForm.validate('mobile');\n      } catch (error) {\n        return console.log('手机号格式错误', error);\n      }\n      this.isShowCountDown = true;\n      // 通过，显示倒计时\n      // 请求发送验证码\n    }\n  }\n};","map":{"version":3,"mappings":"AA+BA;AACA;EACAA;EACAC;IACA;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;QACAC,WACA;UACAC;UACAC;QACA,GACA;UACAC;UACAD;QACA,EACA;QACAE,UACA;UACAH;UACAC;QACA,GACA;UACAC;UACAD;QACA;MAEA;IACA;EACA;EACAG;IACA;MACA;MACA;MACA;QACAH;QACAI;QACAC;MACA;MACA;MACA;QACA;UAAAb;QAAA;QACA;QACA;QACA;QACA;UACAQ;UACAK;QACA;QACA;MACA;QACA;QACA;UACA;YACAL;YACAK;UACA;QACA;UACA;YACAL;YACAK;UACA;UACAC;QACA;MACA;IAEA;IACA;MACA;MACA;MACA;QACA;QACA;MACA;QACA;MACA;MACA;MACA;MACA;IACA;EACA;AACA","names":["name","data","isShowCountDown","user","mobile","code","regRules","regPhone","required","message","pattern","regCode","methods","forbidClick","duration","console"],"sourceRoot":"src/views/Login","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div class='login-container'>\r\n    <!-- 导航栏 -->\r\n    <van-nav-bar title=\"登录\" class='page-nav-bar'>\r\n      <template #left>\r\n        <van-icon name=\"cross\" size=\"24\" color=\"#fff\" @click='$router.back()' />\r\n      </template>\r\n    </van-nav-bar>\r\n    <!-- /导航栏 -->\r\n    <!-- 表单 -->\r\n    <van-form ref='loginForm' @submit=\"onSubmit\">\r\n      <van-field v-model=\"user.mobile\" left-icon='shouji' center icon-prefix='toutiao' name=\"mobile\" placeholder=\"请输入手机号\" :rules=\"regRules.regPhone\" type='number' maxlength='11' autocomplete='off' />\r\n      <van-field v-model=\"user.code\" left-icon='yanzhengma' center icon-prefix='toutiao' name=\"code\" placeholder=\"请输入验证码\" :rules=\"regRules.regCode\" type='number' maxlength='6' autocomplete='off'>\r\n        <template #button>\r\n          <van-count-down :time=\"6*1000\" format='ss s' @finish='isShowCountDown=false' v-if=\"isShowCountDown\">\r\n            <template #default=\"timeData\">\r\n              <span class=\"block\">{{ timeData.seconds+' s' }}</span>\r\n            </template>\r\n          </van-count-down>\r\n          <van-button size=\"small\" round plain type='info' @click=\"sendSms\" native-type=\"button\" v-else>发送验证码</van-button>\r\n        </template>\r\n      </van-field>\r\n      <div style=\"margin: 16px;\">\r\n        <van-button block type=\"info\" native-type=\"submit\">登录</van-button>\r\n      </div>\r\n    </van-form>\r\n    <!-- /表单 -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { login } from '@/api/user'\r\nexport default {\r\n  name: 'Login',\r\n  data () {\r\n    return {\r\n      isShowCountDown: false,\r\n      user: {\r\n        mobile: '18612345678',\r\n        code: '246810'\r\n      },\r\n      regRules: {\r\n        regPhone: [\r\n          {\r\n            required: true,\r\n            message: '请填写手机号'\r\n          },\r\n          {\r\n            pattern: /^1(3\\d|4[5-9]|5[0-35-9]|6[567]|7[0-8]|8\\d|9[0-35-9])\\d{8}$/,\r\n            message: '手机号格式错误'\r\n          }\r\n        ],\r\n        regCode: [\r\n          {\r\n            required: true,\r\n            message: '请填写验证码'\r\n          },\r\n          {\r\n            pattern: /^\\d{6}$/,\r\n            message: '验证码格式不正确'\r\n          },\r\n        ]\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    async onSubmit () {\r\n      const user = this.user\r\n      // 显示loading\r\n      this.$toast.loading({\r\n        message: '加载中...',\r\n        forbidClick: true,\r\n        duration: 0  //持续展示\r\n      });\r\n      //  发起请求，获取数据\r\n      try {\r\n        const { data } = await login(user)\r\n        // console.log('登录成功', res)\r\n        // 通过vuex设置state中user的信息，包含token和refresh token\r\n        this.$store.commit('setUser', data.data)\r\n        this.$toast.success({\r\n          message: '登录成功',\r\n          duration: 800\r\n        })\r\n        this.$router.back()\r\n      } catch (error) {\r\n        // console.log(error)\r\n        if (error.response.status === 400) {\r\n          this.$toast.fail({\r\n            message: error.response.data.message,\r\n            duration: 800\r\n          })\r\n        } else {\r\n          this.$toast.fail({\r\n            message: '登陆失败',\r\n            duration: 800\r\n          })\r\n          console.log('登录失败', error)\r\n        }\r\n      }\r\n\r\n    },\r\n    async sendSms () {\r\n      // 验证 手机号\r\n      // validate('mobile') 返回promise对象\r\n      try {\r\n        // console.log(1)\r\n        await this.$refs.loginForm.validate('mobile')\r\n      } catch (error) {\r\n        return console.log('手机号格式错误', error)\r\n      }\r\n      this.isShowCountDown = true\r\n      // 通过，显示倒计时\r\n      // 请求发送验证码\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n::v-deep .toutiao {\r\n  font-size: 36px;\r\n}\r\n.block {\r\n  border: 1px solid #e2e2e2;\r\n  height: 62px;\r\n  line-height: 62px;\r\n  padding: 0 36px;\r\n  font-size: 24px;\r\n  display: inline-block;\r\n  text-align: center;\r\n  color: #e2e2e2;\r\n  border-radius: 32px;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}