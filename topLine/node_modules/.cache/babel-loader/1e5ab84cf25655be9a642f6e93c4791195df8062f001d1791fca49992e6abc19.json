{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getSearchResultApi } from '@/api/search';\nexport default {\n  props: {\n    inputVal: {\n      type: String,\n      required: true\n    }\n  },\n  data() {\n    return {\n      list: [],\n      loading: false,\n      finished: false,\n      page: 1,\n      per_page: 15,\n      error: false\n    };\n  },\n  methods: {\n    async onLoad() {\n      // 异步更新数据\n      //ajax 请求\n      try {\n        // 1. 请求获取数据\n        const {\n          data\n        } = await getSearchResultApi({\n          page: this.page,\n          per_page: this.per_page,\n          q: this.inputVal\n        });\n        // 模拟加载失败的代码\n        if (Math.random() > 0.5) {\n          JSON.parse('dsadsa');\n        }\n        console.log(data.data);\n\n        // 2. 将数据添加到数组列表中\n        const {\n          results\n        } = data.data;\n        this.list.push(...results);\n\n        //3. 加载状态结束\n        this.loading = false;\n\n        //4.判断是否还有数据\n        if (results.length) {\n          // 有page++\n          this.page++;\n        } else {\n          // 没有，显示没有更多数据了\n          this.finished = true;\n        }\n      } catch (error) {\n        // 加载失败提示\n        this.error = true;\n        // 加载失败，loading=false 关闭\n        this.loading = false;\n      }\n    }\n  }\n};","map":{"version":3,"mappings":";AAkBA;AACA;EACAA;IACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;MACA;MACA;MACA;QACA;QACA;UAAAP;QAAA;UACAI;UACAC;UACAG;QACA;QACA;QACA;UACAC;QACA;QACAC;;QAEA;QACA;UAAAC;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;UACA;UACA;QACA;UACA;UACA;QACA;MACA;QACA;QACA;QACA;QACA;MACA;IACA;EACA;AACA","names":["props","inputVal","type","required","data","list","loading","finished","page","per_page","error","methods","q","JSON","console","results"],"sourceRoot":"src/views/Search/components","sources":["SearchResult.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <van-list\r\n      v-model=\"loading\"\r\n      :finished=\"finished\"\r\n      finished-text=\"没有更多了\"\r\n      :error.sync=\"error\"\r\n      error-text=\"加载失败，请点击重试\"\r\n      @load=\"onLoad\">\r\n      <van-cell\r\n        v-for=\"(item, index) in list\"\r\n        :key=\"index\"\r\n        :title=\"index + ' ' + item.title\" />\r\n    </van-list>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getSearchResultApi } from '@/api/search'\r\nexport default {\r\n  props: {\r\n    inputVal: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      list: [],\r\n      loading: false,\r\n      finished: false,\r\n      page: 1,\r\n      per_page: 15,\r\n      error: false,\r\n    }\r\n  },\r\n  methods: {\r\n    async onLoad() {\r\n      // 异步更新数据\r\n      //ajax 请求\r\n      try {\r\n        // 1. 请求获取数据\r\n        const { data } = await getSearchResultApi({\r\n          page: this.page,\r\n          per_page: this.per_page,\r\n          q: this.inputVal,\r\n        })\r\n        // 模拟加载失败的代码\r\n        if (Math.random() > 0.5) {\r\n          JSON.parse('dsadsa')\r\n        }\r\n        console.log(data.data)\r\n\r\n        // 2. 将数据添加到数组列表中\r\n        const { results } = data.data\r\n        this.list.push(...results)\r\n\r\n        //3. 加载状态结束\r\n        this.loading = false\r\n\r\n        //4.判断是否还有数据\r\n        if (results.length) {\r\n          // 有page++\r\n          this.page++\r\n        } else {\r\n          // 没有，显示没有更多数据了\r\n          this.finished = true\r\n        }\r\n      } catch (error) {\r\n        // 加载失败提示\r\n        this.error = true\r\n        // 加载失败，loading=false 关闭\r\n        this.loading = false\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style></style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}